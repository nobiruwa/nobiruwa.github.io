<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/hakyll-cssgarden/bronx.css">
    <link rel="stylesheet" href="../css/syntax.css">
    <link rel="stylesheet" href="../css/custom.css">
    <title>My Hakyll Blog - EmacsでのPython開発</title>
  </head>
  <body>
    <div id="header">
      <div id="logo">
        <a href="../">Nobiruwa's</a>
      </div>
      <div id="navigation">
        <a href="../">Home</a>
        <a href="../archive.html">Archive</a>
      </div>
    </div>

    <div id="content">
      <h1>EmacsでのPython開発</h1>

      <div class="info">
    Posted on September 16, 2021
    
        by nobiruwa
    
</div>

<h2 id="tldr">tl;dr</h2>
<p><a href="https://github.com/emacs-lsp/lsp-mode">lsp-mode</a>, <a href="https://github.com/emacs-lsp/lsp-pyright">lsp-pyright</a>と<a href="https://github.com/Microsoft/pyright">pyright</a>を用いることで、十分に快適な環境を得ることができました。</p>
<h2 id="lsp-mode-lsp-pyright-pyright-の構築手順">lsp-mode + lsp-pyright + pyright の構築手順</h2>
<h3 id="npmのインストール">npmのインストール</h3>
<p>pyrightはNode.jsパッケージです。よって、はじめに<code>npm</code>コマンドをインストールします。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt install npm</span></code></pre></div>
<h3 id="emacsパッケージのインストール">Emacsパッケージのインストール</h3>
<pre class="emacs"><code>M-x package-install
lsp-mode
lsp-pyright</code></pre>
<p>lsp-modeの設定は<a href="2019-04-07-emacs-as-cpp-ide.md">過去の記事</a>で書いた通りなので省略します。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">;;;;;;;;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">;; lsp-pyright</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">;;;;;;;;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>(<span class="kw">require</span> 'lsp-pyright)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>(add-hook 'python-mode-hook #'lsp)</span></code></pre></div>
<h3 id="pyrightのインストール">pyrightのインストール</h3>
<p>pyrightはEmacsにlsp-pyrightを入れた後、Pythonのソースコードを開いたときにインストールのミニプロンプトでインストールことができます。 選択肢は<code>pyright</code>しかありませんので迷うことはないでしょう。</p>
<pre><code>Unable to find installed server supporting this file. The following servers could be installed automatically: pyright[Enter]</code></pre>
<p>この手順により<code>pyright</code>コマンドは<code>~/.emacs.d/.cache/lsp/npm/pyright/bin/pyright</code>にインストールされます。</p>
<h2 id="virtualenvを使うプロジェクトの設定">virtualenvを使うプロジェクトの設定</h2>
<p>私はしばしばvirtualenvを使います。virtualenvにしかないパッケージに対して補完を有効にするために、プロジェクトディレクトリに以下の内容を含む<code>pyrightconfig.json</code>を用意します。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;venvPath&quot;</span><span class="fu">:</span> <span class="st">&quot;~/.venvs&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;venv&quot;</span><span class="fu">:</span> <span class="st">&quot;sandbox&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>この場合、<code>~/.venvs/sandbox</code>ディレクトリのvirtualenv環境が使われます。</p>
<p><code>pyrightconfig.json</code>の書式は<a href="https://github.com/microsoft/pyright/blob/main/docs/configuration.md">Pyright Configuration</a>で確認できます。</p>

    </div>
    <div id="footer">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </div>
  </body>
</html>
