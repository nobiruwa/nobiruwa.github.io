<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/hakyll-cssgarden/bronx.css">
    <link rel="stylesheet" href="../css/syntax.css">
    <link rel="stylesheet" href="../css/custom.css">
    <title>My Hakyll Blog - EmacsでのCommon Lisp開発</title>
  </head>
  <body>
    <div id="header">
      <div id="logo">
        <a href="../">Nobiruwa's</a>
      </div>
      <div id="navigation">
        <a href="../">Home</a>
        <a href="../archive.html">Archive</a>
      </div>
    </div>

    <div id="content">
      <h1>EmacsでのCommon Lisp開発</h1>

      <div class="info">
    Posted on August 10, 2020
    
        by nobiruwa
    
</div>

<h2 id="tldr">tl;dr</h2>
<pre class="console"><code>$ sudo apt-get -y install git build-essential automake libcurl4-openssl-dev
$ git clone -b release https://github.com/roswell/roswell.git $HOME/repo/roswell.git
$ cd $HOME/repo/roswell.git
$ sh bootstrap
$ ./configure --prefix=$HOME/opt/roswell
$ make
$ make install

// $HOME/opt/roswell/binをPATHに通した後:
$ ros setup</code></pre>
<h2 id="動機">動機</h2>
<p>QuickLispを使っていたのですが、cronで動作するスクリプトを作成するためにQuickLispのディレクトリをスクリプト内に埋め込んだり、イマイチ使いこなせている気がしなかったので、環境を管理するユーティリティがないかを探してRoswellに辿り着きました。</p>
<p><a href="https://github.com/roswell/roswell">Roswell</a>はCommon Lispの実装のインストーラー兼マネージャー兼ランチャー兼etc.です。</p>
<p>丁寧な<a href="https://github.com/roswell/roswell/wiki">Wiki</a>があり、使い方を学ぶことができます。</p>
<h2 id="インストール">インストール</h2>
<p><a href="https://github.com/roswell/roswell/wiki/Installation#building-from-source">Wiki</a>で十分に説明されています。が、私はユーザーディレクトリの<code>opt</code>ディレクトリにインストールしてPATHを通すスタイルが好きなので、実行するコマンドを少し変更しました。ソースコードリポジトリのローカルディレクトリ名も<code>&lt;プロジェクト名&gt;.&lt;コマンド名&gt;</code>(ex: <code>roswell.git</code>、<code>rxvt-unicode.svn</code>など)と独特の管理をしています。</p>
<pre class="console"><code>$ sudo apt-get -y install git build-essential automake libcurl4-openssl-dev
$ git clone -b release https://github.com/roswell/roswell.git $HOME/repo/roswell.git
$ cd $HOME/repo/roswell.git
$ sh bootstrap
$ ./configure --prefix=$HOME/opt/roswell
$ make
$ make install

// $HOME/opt/roswell/binをPATHに通した後:
$ ros setup</code></pre>
<h2 id="emacsのセットアップ">Emacsのセットアップ</h2>
<p>Wikiの<a href="https://github.com/roswell/roswell/wiki/Initial-Recommended-Setup#for-emacs">for Emacs</a>の通りです。</p>
<pre class="console"><code>$ ros install slime</code></pre>
<p>私はddskkを使って日本語入力をしており、SKKの変換ができるようキーバインドを変更しています。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> ((slime-helper (expand-file-name <span class="st">&quot;~/.roswell/helper.el&quot;</span>)))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">when</span> (file-exists-p slime-helper)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">load</span> slime-helper)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">;; SLIMEとSKKとの衝突を回避する設定</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">;; 特定の場面で、SLIMEとSKKとの間でスペースキーのキーバインドが競合して、SKKでの変換ができなくなります。</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">;; https://lisphub.jp/common-lisp/cookbook/index.cgi?SLIME#H-33uy3rfpe0845</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">defun</span><span class="fu"> my-slime-space </span>(n)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      (interactive <span class="st">&quot;p&quot;</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">if</span> (<span class="kw">and</span> (<span class="kw">boundp</span> <span class="dt">'skk-henkan-mode</span>) skk-henkan-mode)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>          (skk-insert n)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        (slime-autodoc-space n)))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    (define-key slime-autodoc-mode-map <span class="st">&quot; &quot;</span> <span class="dt">'my-slime-space</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">setq</span> inferior-lisp-program <span class="st">&quot;ros -Q run&quot;</span>)))</span></code></pre></div>
<h2 id="サンプルスクリプト">サンプルスクリプト</h2>
<p>Wikiの<a href="https://github.com/roswell/roswell/wiki#scripting-with-roswell">Scripting with Roswell</a>の通りです。</p>
<pre class="console"><code>$ cd $HOME
$ ln -s .roswell/local-projects lispprojects
$ cd lispprojects
$ mkdir scripting-with-roswell
$ cd scripting-with-roswell
$ ros init fact

// fact.rosが生成されるので、次のように編集する:
$ cat fact.ros
#!/bin/sh
#|-*- mode:lisp -*-|#
#|
exec ros -Q -- $0 &quot;$@&quot;
|#

(defun fact (n)
  (if (zerop n)
      1
      (* n (fact (1- n)))))

(defun main (n &amp;rest argv)
  (declare (ignore argv))
  (format t &quot;~&amp;Factorial ~D = ~D~%&quot; n (fact (parse-integer n))))
$ ./fact.ros 10
Factorial 10 = 3628800</code></pre>

    </div>
    <div id="footer">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </div>
  </body>
</html>
