<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/hakyll-cssgarden/bronx.css">
    <link rel="stylesheet" href="../css/syntax.css">
    <link rel="stylesheet" href="../css/custom.css">
    <title>My Hakyll Blog - Raspberry Pi OSをBullseyeにアップグレードする</title>
  </head>
  <body>
    <div id="header">
      <div id="logo">
        <a href="../">Nobiruwa's</a>
      </div>
      <div id="navigation">
        <a href="../">Home</a>
        <a href="../archive.html">Archive</a>
      </div>
    </div>

    <div id="content">
      <h1>Raspberry Pi OSをBullseyeにアップグレードする</h1>

      <div class="info">
    Posted on September 24, 2021
    
        by nobiruwa
    
</div>

<h2 id="busterからbullseyeへアップグレード">BusterからBullseyeへアップグレード</h2>
<p>2021年8月に<a href="https://www.debian.org/releases/stable/">Debian GNU Linux bullseye</a>がリリースされました。Raspberry Pi OSの公式リリースに先駆けてBullseyeをインストールすることにしました。</p>
<h2 id="etcaptsources.listの更新"><code>/etc/apt/sources.list</code>の更新</h2>
<p>使用するリポジトリを<code>buster</code>から<code>bullseye</code>に変更する必要があります。32bit版を使っているので以下の通りに変更しました。</p>
<h3 id="etcaptsources.list.ddocker.listの更新"><code>/etc/apt/sources.list.d/docker.list</code>の更新</h3>
<pre><code>deb [arch=armhf signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/raspbian bullseye stable</code></pre>
<h3 id="etcaptsources.list.draspi.listの更新"><code>/etc/apt/sources.list.d/raspi.list</code>の更新</h3>
<pre><code>deb http://archive.raspberrypi.org/debian/ bullseye main
# Uncomment line below then 'apt-get update' to enable 'apt-get source'
#deb-src http://archive.raspberrypi.org/debian/ buster main</code></pre>
<h2 id="aptの実行"><code>apt</code>の実行</h2>
<p>手順は<a href="https://www.debian.org/releases/stable/amd64/release-notes/ch-upgrading.en.html#backup">Chapter 4. Upgrades from Debian 10 (buster)</a>を参考にしました。</p>
<pre class="console"><code># apt clean # 古いパッケージのキャッシュを削除
# apt update
# apt upgrade --without-new-pkgs
# apt --purge remove libgcc-8-dev gcc-8-base # 競合の削除
# apt full-upgrade
# apt --purge autoremove
# reboot</code></pre>
<p>途中<code>apt full-upgrade</code>でパッケージを展開できなくなっていたため、SDカードをPCに挿して<code>fsck -y &lt;SDカードのパーティションに対応したブロックデバイス&gt;</code>によりファイルシステムを修復する必要がありました。</p>
<h2 id="アップグレード後">アップグレード後</h2>
<h3 id="i2cを有効にする">I2Cを有効にする</h3>
<p>アップグレード後、I2Cが無効になっていたため、有効にしました。</p>
<pre class="console"><code># raspi-config
=&gt; 3 Interface Options
=&gt; P5 I2C
=&gt; `Would you like the ARM I2C interface to be enabled?`という質問に`&lt;Yes&gt;`と回答することで有効になる</code></pre>
<h3 id="python環境の最新化">Python環境の最新化</h3>
<p>pythonのバージョンが3.9になったため、<code>pip</code>コマンドの再インストールや<code>virtualenv</code>環境の再構築を行いました。</p>
<pre class="console"><code>$ python3 get-pip.py --user</code></pre>
<pre class="console"><code>$ rm ~/.local/bin/easy_install-&lt;古いバージョン&gt;
$ rm ~/.local/bin/pip&lt;古いバージョン&gt;
$ rm -rf ~/.local/lib/python&lt;古いバージョン&gt;</code></pre>
<pre class="console"><code>$ . &lt;virtualenvディレクトリ&gt;/bin/activate
$ pip install --upgrade &lt;パッケージ&gt;...
$ deactivate</code></pre>

    </div>
    <div id="footer">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </div>
  </body>
</html>
