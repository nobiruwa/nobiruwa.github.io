<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/hakyll-cssgarden/bronx.css">
    <link rel="stylesheet" href="../css/syntax.css">
    <link rel="stylesheet" href="../css/custom.css">
    <title>My Hakyll Blog - EmacsでのRust開発</title>
  </head>
  <body>
    <div id="header">
      <div id="logo">
        <a href="../">Nobiruwa's</a>
      </div>
      <div id="navigation">
        <a href="../">Home</a>
        <a href="../archive.html">Archive</a>
      </div>
    </div>

    <div id="content">
      <h1>EmacsでのRust開発</h1>

      <div class="info">
    Posted on April  3, 2021
    
        by nobiruwa
    
</div>

<h2 id="tldr">tl;dr</h2>
<p><a href="https://github.com/rust-lang/rust-mode">rust-mode</a>, <a href="https://github.com/emacs-lsp/lsp-mode">lsp-mode</a>, <a href="https://github.com/kwrooijen/cargo.el">cargo.el</a>と<a href="https://github.com/rust-lang/rls">rls</a>を用いることで、十分に快適な環境を得ることができました。</p>
<h2 id="rust-mode-lsp-mode-cargo.el-rls-の構築手順">rust-mode + lsp-mode + cargo.el + rls の構築手順</h2>
<p>開発のモードとしてrust-modeとlsp-modeとcargo.elのcargo-minor-modeを用い、バックエンドには<code>rls</code>を用います。</p>
<h3 id="rlsのインストール">rlsのインストール</h3>
<p><a href="https://github.com/rust-lang/rls#setup">公式の手順</a>に従って<code>rls</code>をインストールします。</p>
<pre class="console"><code>$ rustup update
$ rustup component add rls rust-analysis rust-src</code></pre>
<h3 id="emacsパッケージのインストール">Emacsパッケージのインストール</h3>
<pre class="emacs"><code>M-x package-install
cargo
lsp-mode
lsp-ui
rust-mode</code></pre>
<h3 id="emacsパッケージの設定">Emacsパッケージの設定</h3>
<p>lsp-modeとlsp-uiの設定は<a href="2019-04-07-emacs-as-cpp-ide.html">過去の記事</a>で書いた通りなので省略します。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">;;;;;;;;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">;; cargo-minor-mode</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">;;;;;;;;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>(<span class="kw">require</span> 'rust-mode)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>(add-hook 'rust-mode-hook 'cargo-minor-mode)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">;;;;;;;;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">;; rust-mode</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">;;;;;;;;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>(<span class="kw">require</span> 'rust-mode)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>(add-hook 'rust-mode-hook</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">lambda</span> ()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            (<span class="kw">setq</span> indent-tabs-mode <span class="kw">nil</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            (lsp)))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">;; Formatting is bound to C-c C-f.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">;; The folowing enables automatic formatting on save.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>(<span class="kw">setq</span> rust-format-on-save <span class="kw">t</span>)</span></code></pre></div>
<h2 id="cargo-edit-cargo-featureのインストール">cargo-edit, cargo-featureのインストール</h2>
<p><a href="https://github.com/killercup/cargo-edit">cargo-edit</a>は<code>cargo add/rm/upgrade/set-version</code>サブコマンドを追加します。また、<a href="https://github.com/Riey/cargo-feature">cargo-feature</a>は<code>cargo feature</code>サブコマンドを追加します。</p>
<p><code>cargo add</code>と<code>cargo feature</code>を使うと、<code>Cargo.toml</code>の<code>[dependencies]</code>セクションと<code>[dev-dependencies]</code>セクションを記述するかわりに、コマンドラインから編集できるようになります。私には合っていると思い導入することにします。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt install libssl-dev</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo install cargo-edit</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo install cargo-feature</span></code></pre></div>
<p>ちなみに、サブコマンドの実体は<code>~/.cargo/bin</code>ディレクトリにあります。<code>cargo-add</code>, <code>cargo-feature</code>といったようにサブコマンドごとの実行ファイルが追加されます。</p>

    </div>
    <div id="footer">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </div>
  </body>
</html>
